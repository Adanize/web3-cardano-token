!function(e,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var t=r();for(var o in t)("object"==typeof exports?exports:e)[o]=t[o]}}(global,(function(){return(()=>{"use strict";var e,r,t={63:e=>{e.exports=require("@emurgo/cardano-serialization-lib-browser")},111:e=>{e.exports=require("@emurgo/cardano-serialization-lib-nodejs")},700:e=>{e.exports=require("emurgo-message-signing")},216:e=>{e.exports=require("emurgo-message-signing-nodejs")}},o={};function n(e){var r=o[e];if(void 0!==r)return r.exports;var s=o[e]={exports:{}};return t[e](s,s.exports,n),s.exports}n.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return n.d(r,{a:r}),r},r=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,n.t=function(t,o){if(1&o&&(t=this(t)),8&o)return t;if("object"==typeof t&&t){if(4&o&&t.__esModule)return t;if(16&o&&"function"==typeof t.then)return t}var s=Object.create(null);n.r(s);var i={};e=e||[null,r({}),r([]),r(r)];for(var a=2&o&&t;"object"==typeof a&&!~e.indexOf(a);a=r(a))Object.getOwnPropertyNames(a).forEach((e=>i[e]=()=>t[e]));return i.default=()=>t,n.d(s,i),s},n.d=(e,r)=>{for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{n.d(s,{default:()=>u});const e=require("base-64");var r=n.n(e);const t=require("ms");var o=n.n(t);const i=require("parse-headers");var a=n.n(i);const d=require("buffer"),f=new class{async load(){this._wasm&&this._wasm2||(this.isBrowser="undefined"!=typeof window,this._wasm=this.isBrowser?await Promise.resolve().then(n.t.bind(n,63,23)):await Promise.resolve().then(n.t.bind(n,111,23)),this._wasm2=this.isBrowser?await Promise.resolve().then(n.t.bind(n,700,23)):await Promise.resolve().then(n.t.bind(n,216,23)))}get Cardano(){return this._wasm}get Message(){return this._wasm2}},u={sign:async(e,t="1d",n={})=>{const s=(e=>{const r='"expires_in" argument should be a number of milliseconds or a string representing a timespan eg: "1d", "20h", 60';if("string"==typeof e){const t=o()(e);if(void 0===t)throw new Error(r);return new Date(Date.now()+t).toUTCString()}if("number"==typeof e)return new Date(Date.now()+e).toUTCString();throw new Error(r)})(t);(e=>{for(const r in e){const t=e[r];if("Expire-Date"===r)throw new Error('Please do not rewrite "Expire-Date" field');if("Web3-Token-Version"===r)throw new Error('Please do not rewrite "Web3-Token-Version" field');if("string"!=typeof t)throw new Error("Body can only contain string values")}})(n);const i=(e=>{const r=[];for(const t in e)r.push(`${t}: ${e[t]}`);return r.join("\n")})({"Web3-Token-Version":1,"Expire-Date":s,...n});if("function"!=typeof e)throw new Error('"signer" argument should be a function that returns a signature eg: "msg => web3.eth.personal.sign(msg, <YOUR_ADDRESS>)"');var a=await e(i);if("string"!=typeof a)throw new Error('"signer" argument should be a function that returns a signature string (Promise<string>)');return r().encode(JSON.stringify({signature:a,body:i}))},verify:async e=>{if(!e||!e.length)throw new Error("Token required.");try{var t=r().decode(e)}catch(e){throw new Error("Token malformed (must be base64 encoded)")}if(!t||!t.length)throw new Error("Token malformed (must be base64 encoded)");try{var{body:o,signature:n}=JSON.parse(t)}catch(e){throw new Error("Token malformed (unparsable JSON)")}if(!o||!o.length)throw new Error("Token malformed (empty message)");if(!n||!n.length)throw new Error("Token malformed (empty signature)");await f.load();const s=f.Message.COSESign1.from_bytes(d.Buffer.from(d.Buffer.from(n,"hex"),"hex")).headers().protected().deserialized_headers(),i=f.Cardano.Address.from_bytes(s.header(f.Message.Label.new_text("address")).as_bytes()),u=a()(o);if(u["expire-date"]&&new Date(u["expire-date"])<new Date)throw new Error("Token expired");return{address:i.to_bech32(),body:u}}}})(),s.default})()}));